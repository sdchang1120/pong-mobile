<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <style media="screen">
      body {
        padding:0;
        margin:0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
  </body>
  <script type="text/javascript">
  // VARIABLES
  var canvas, context, playerOne, playerTwo, ball, keyState;

  // OBJECTS
  playerOne = {
    x: 0,
    y: 0,
    width: 10,
    height: 75,
    //score: 0 /*implement later*/
    update: function() {
      if (keyState[87]) { // w key
        this.y -= 5
      };
      if (keyState[83]) { // s key
        this.y += 5
      };
    },
    draw: function() {
      context.fillRect(this.x, this.y, this.width, this.height);
    }
  }
  playerTwo = {
    x: 0,
    y: 0,
    width: 10,
    height: 75,
    //score: 0 /*implement later*/
    update: function() {
      if (keyState[38]) { // down arrow
        this.y -= 5
      };
      if (keyState[40]) { // up arrow
        this.y += 5
      };
    },
    draw: function() {
      context.fillRect(this.x, this.y, this.width, this.height);
    }
  }
  ball = {
    x: 0,
    y: 0,
    side: 10,
    vel: null,
    speed: 3,
    radius: 5,
    update: function() {
      // update ball position with velocity
      this.x += this.vel.x;
      this.y += this.vel.y;

      // if ball goes beyond canvas in y-direction
      if (0 > this.y || this.y+this.side > canvas.height) {
        // calculate in the offset on both ends of canvas
        var offset = this.vel.y < 0 ? 0 - this.y : canvas.height - (this.y+this.side);
        this.y += 2*offset;
        // reverse the direction of ball
        this.vel.y *= -1;
      }
    },
    draw: function() {
      context.beginPath();
      context.arc(this.x+5, this.y+5, this.radius, 0, 2*Math.PI, false); // gives ball its round shape
      // context.fillRect(this.x, this.y, this.side, this.side);
      context.fillStyle = 'red'; //ball trail not working
      context.fill();
      context.closePath();
    }
  }

  // SETUP
  // window.addEventListener('load', function() {
  function main() {
    canvas = document.querySelector('#canvas');
    canvas.width = window.innerWidth - 10;
    canvas.height = window.innerHeight - 10;
    context = canvas.getContext('2d');
    document.body.appendChild(canvas);

    keyState = {}; // TODO: Use touchstart, touchmove, touchend event listeners
    document.addEventListener('keydown', function(event) {
      keyState[event.keyCode] = true;
    });
    document.addEventListener('keyup', function(event) {
      delete keyState[event.keyCode];
    });

    init(); // initiate game

    var loop = function() {
      update();
      draw();
      window.requestAnimationFrame(loop, canvas);
    }
    window.requestAnimationFrame(loop, canvas);
  }
  // });

  // INITIALIZE OBJS
  function init() {
    playerOne.x = playerOne.width;
    playerOne.y = (canvas.height - playerOne.height)/2;

    playerTwo.x = canvas.width - (playerOne.width + playerTwo.width);
    playerTwo.y = (canvas.height - playerTwo.height)/2;

    ball.x = (canvas.width - ball.side)/2;
    ball.y = (canvas.height - ball.side)/2;

    ball.vel = {
      x: ball.speed,
      y: 0
    }
  }

  // UPDATE OBJS
  function update() {
    playerOne.update();
    playerTwo.update();
    ball.update();
  }

  // DRAW OBJS
  function draw() {
    context.fillRect(0, 0, canvas.width, canvas.height);
    context.save();
    context.fillStyle = "white";
    playerOne.draw();
    playerTwo.draw();
    ball.draw();
    context.restore();
  }

  main();
  </script>
</html>
